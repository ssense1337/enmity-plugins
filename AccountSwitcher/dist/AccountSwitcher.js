function se(e){window.enmity.plugins.registerPlugin(e)}function me(e,o){return window.enmity.modules.getModule(e,o)}function O(...e){return window.enmity.modules.getByProps(...e)}function ue(...e){return window.enmity.modules.getByTypeName(...e)}function V(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function de(e){return window.enmity.patcher.create(e)}var ge="AccountSwitcher",he="1.0.2",ye="Switch between multiple accounts.",we="#64D3FF",pe=[{name:"ssense",id:"146080957965795328"}],I={name:ge,version:he,description:ye,color:we,authors:pe};function W(e,o,r){return window.enmity.utilities.findInReactTree(e,o,r)}const b=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars;const Se=window.enmity.modules.common.Native,t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const $=window.enmity.modules.common.Toasts,K=window.enmity.modules.common.Dialog,F=window.enmity.modules.common.Token;window.enmity.modules.common.REST,window.enmity.modules.common.Settings;const Ae=window.enmity.modules.common.Users,C=window.enmity.modules.common.Navigation,T=window.enmity.modules.common.NavigationNative,X=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const N=window.enmity.modules.common.StyleSheet,U=window.enmity.modules.common.ColorMap;window.enmity.modules.common.Components;const E=window.enmity.modules.common.Locale,Ee=window.enmity.modules.common.Profiles;window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG;const fe=window.enmity.modules.common.Scenes,{components:n}=window.enmity,Ce=n.Alert,Te=n.Button;n.FlatList;const Y=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal,n.Pressable;const Re=n.RefreshControl,ve=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const S=n.Text;n.TextInput,n.TouchableHighlight;const x=n.TouchableOpacity;n.TouchableWithoutFeedback,n.Touchable;const g=n.View;n.VirtualizedList,n.Form;const q=n.FormArrow;n.FormCTA;const Ie=n.FormCTAButton;n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon;const k=n.FormInput;n.FormLabel,n.FormRadio;const p=n.FormRow;n.FormSection,n.FormSelect,n.FormSubLabel,n.FormSwitch,n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;function f(e){return window.enmity.assets.getIDByName(e)}const z=O("loginToken"),{default:H}=me(e=>e==null?void 0:e.ButtonColors),J=e=>e.id?{id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar,...e.email&&{email:e.email},...e.phone&&{phone:e.phone}}:{};async function Q(e){const o=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return J(o)}const be=()=>{const e=()=>{z.logout()};K.show({isDismissable:!0,title:E.Messages.LOGOUT,body:E.Messages.USER_SETTINGS_CONFIRM_LOGOUT,confirmColor:"red",confirmText:E.Messages.LOGOUT,cancelText:E.Messages.CANCEL,onConfirm:e})},Z=({title:e="Are you sure?",body:o,confirmColor:r,confirmText:i="Yes",cancelText:l="No",onConfirm:a,onCancel:c})=>{if(!F.getToken())return Ce.alert(e,o,[{text:i,onPress:a},{text:l,onPress:c}]);K.show({isDismissable:!0,title:e,body:o,confirmColor:r,confirmText:i,cancelText:l,onConfirm:a,onCancel:c})},A={AddWhite:f("add_white"),Checkmark:f("Check"),Key:f("ic_authed_apps_24px"),MyAccount:f("ic_my_account_24px"),Passport:f("ic_passport_24px"),Settings:f("settings"),TrashFilled:f("ic_trash_filled_16px"),Sort:f("ic_sort")},ee=O("openLazy","hideActionSheet"),j=O("hex2int"),Fe=V("CustomColorPickerActionSheet"),te=({onSelect:e,defaultColor:o="#000000",resetText:r=E.Messages.RESET})=>{const i=j.hex2int(o);ee.openLazy(()=>new Promise(l=>l(Fe)),"CustomColorPicker",{color:i,onSelect:e,resetText:r,resetColor:i})};function M(e,o){return window.enmity.settings.connectComponent(e,o)}const{ThemeColorMap:ne}=U;function ke({account:e}){if(!e)return null;const o=N.createThemedStyleSheet({linkless:{color:ne.HEADER_SECONDARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD,display:"flex",fontSize:16,alignItems:"center",alignSelf:"center",justifyContent:"center"},link:{color:ne.HEADER_PRIMARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD,display:"flex",alignItems:"center",fontSize:16,alignSelf:"center",justifyContent:"center"}});return t.createElement(g,null,(r=>typeof r=="string"?t.createElement(S,{style:o.linkless},r):typeof r=="object"&&r.username&&!r.id?t.createElement(S,{style:o.linkless},r.username):typeof r=="object"&&r.username&&r.id?t.createElement(x,{key:r.id,onPress:()=>Ee.showUserProfile({userId:r.id})},t.createElement(S,{style:o.link},r.username)):null)(e))}const{ThemeColorMap:B}=U,{RNCPushNotificationIOS:Me}=Se;function Pe({account:e,position:o,settings:r,navigation:i}){var l,a;const c=N.createThemedStyleSheet({container:{backgroundColor:B.BACKGROUND_SECONDARY,borderRadius:5,borderLeftColor:(l=e.color)!=null?l:"#524FBF",borderLeftWidth:5,marginBottom:15},name:{color:B.HEADER_PRIMARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD,fontSize:16},content:{height:"auto",paddingBottom:10,paddingLeft:10,paddingRight:10},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},description:{color:B.HEADER_SECONDARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD},info:{marginLeft:-6,flexDirection:"row",alignItems:"center",flexWrap:"wrap",width:"100%"},delete:{marginRight:7.5},trashIcon:{width:22,height:22,tintColor:B.INTERACTIVE_NORMAL},settingsIcon:{width:22,height:22,tintColor:B.INTERACTIVE_NORMAL}});return t.createElement(x,{style:c.container,onPress:()=>{const s=()=>{C.popAll(),Me.abandonPermissions(),z.loginToken(e.token),$.open({content:`Switched to ${e.user.username}`,source:A.Checkmark})};Z({body:`Switch to ${e.label||e.user.username+"#"+e.user.discriminator}?`,onConfirm:s})}},t.createElement(g,null,t.createElement(p,{label:()=>t.createElement(g,{style:c.info},e.label&&t.createElement(S,{adjustsFontSizeToFit:!0,style:c.name},`${e.label} ( `),t.createElement(ke,{account:e.user}),e.label&&t.createElement(S,{adjustsFontSizeToFit:!0,style:c.name}," )")),trailing:()=>t.createElement(g,{style:c.actions},t.createElement(x,{style:c.delete,onPress:()=>{i.navigate("AccountSwitcherEditAccount",{account:e,position:o})}},t.createElement(Y,{style:c.settingsIcon,source:A.Settings})),t.createElement(x,{style:c.delete,onPress:()=>{const s=()=>{const d=r.get("accounts",[]);d.splice(o,1),r.set("accounts",d),$.open({content:"Account Deleted",source:A.Checkmark})};Z({body:e.label?`Delete ${e.label} (${e.user.username}#${e.user.discriminator})?`:`Delete ${e.user.username}#${e.user.discriminator}?`,confirmColor:"red",onConfirm:s})}},t.createElement(Y,{style:c.trashIcon,source:A.TrashFilled})))})),t.createElement(g,{style:c.content},t.createElement(S,{style:c.description},(a=e.description)!=null?a:`ID: ${e.user.id}`)))}const{createThemedStyleSheet:xe}=N;var Be=({settings:e,navigation:o})=>{const[r,i]=t.useState(!1),l=()=>{const d=e.get("accounts",[]);return Array.isArray(d)&&d.sort((m,w)=>{var h,v;return((h=m.label)==null?void 0:h.localeCompare(w.label))||((v=m.username)==null?void 0:v.localeCompare(w.username))})},[a,c]=t.useState(l()),s=xe({container:{flex:1,padding:5}});return t.createElement(t.Fragment,null,t.createElement(g,{style:s.container},t.createElement(ve,{style:s.container,refreshControl:t.createElement(Re,{refreshing:r,onRefresh:()=>{i(!0),c(l()),i(!1)}})},Array.isArray(a)&&a.map((d,m)=>t.createElement(Pe,{account:d,position:m,settings:e,navigation:o})),t.createElement(p,{label:"Add Account (Token)",leading:t.createElement(p.Icon,{source:A.Key}),onPress:()=>{o.navigate("AccountSwitcherAddAccount")}}),Boolean(F.getToken())&&t.createElement(p,{label:"Add Current Account",leading:t.createElement(p.Icon,{source:A.MyAccount}),onPress:()=>{o.navigate("AccountSwitcherAddAccount",{token:F.getToken(),user:J(Ae.getCurrentUser())})}}),t.createElement(p,{label:"Add Account (User/Pass)",leading:t.createElement(p.Icon,{source:A.Passport}),onPress:()=>{Boolean(F.getToken())&&z.loginToken(""),C.popAll()}}),Boolean(F.getToken())&&t.createElement(Ie,{color:"danger",label:E.Messages.LOGOUT,onPress:be}))))};const D=X.createStackNavigator(),{createThemedStyleSheet:L}=N,{ThemeColorMap:R,Colors:oe}=U;function re({navigation:e=T.useNavigation()}){const o=L({header:{tintColor:R.HEADER_PRIMARY,marginRight:15,width:18,height:18},wrapper:{marginRight:15,width:32,height:32}});return t.createElement(x,{styles:o.wrapper,onPress:()=>{e.navigate("AccountSwitcherAddAccount")}},t.createElement(Y,{style:o.header,source:A.AddWhite}))}function ie({settings:e,navigation:o=T.useNavigation(),route:r=T.useRoute()}){const{account:i,position:l}=r.params,[a,c]=t.useState(i.token),[s,d]=t.useState(i.label||""),[m,w]=t.useState(i.description||""),[h,v]=t.useState(i.color||"#524FBF"),y=L({container:{flex:1,padding:16},colorBlock:{minWidth:24,height:24,borderRadius:3,marginHorizontal:0,marginVertical:0,marginRight:8,justifyContent:"center",alignItems:"center"},colorText:{fontFamily:b.Fonts.PRIMARY_SEMIBOLD,color:oe.PRIMARY_DARK_400},row:{flexDirection:"row",alignItems:"center"}});return t.createElement(g,{style:y.container},t.createElement(k,{value:a,onChange:u=>c(u),title:"Account Token"}),t.createElement(k,{value:s,onChange:u=>d(u),title:"Label"}),t.createElement(k,{value:m,onChange:u=>w(u),title:"Description"}),t.createElement(p,{label:()=>t.createElement(S,{adjustsFontSizeToFit:!0,style:y.colorText},"Color"),trailing:()=>t.createElement(g,{style:y.row},t.createElement(g,{style:[y.colorBlock,{backgroundColor:h}]}),t.createElement(S,{style:y.colorText},h),t.createElement(q,null)),onPress:()=>te({onSelect:u=>v(j.int2hex(u)),defaultColor:h})}),t.createElement(g,{style:y.row},t.createElement(H,{onPress:async function(){const u=await Q(a),P=e.get("accounts",[]);P[l]={token:a,user:u,label:s||null,description:m||null,color:h||null},e.set("accounts",P),o.goBack()},text:"Save account"})))}function ce({settings:e,navigation:o=T.useNavigation(),route:r=T.useRoute()}){const{token:i,user:l}=(r==null?void 0:r.params)||{},[a,c]=t.useState(i||""),[s,d]=t.useState(""),[m,w]=t.useState(""),[h,v]=t.useState("#524FBF"),y=L({container:{flex:1,padding:16},colorBlock:{minWidth:24,height:24,borderRadius:3,marginHorizontal:0,marginVertical:0,marginRight:8,justifyContent:"center",alignItems:"center"},colorText:{fontFamily:b.Fonts.PRIMARY_SEMIBOLD,color:oe.PRIMARY_DARK_400},row:{flexDirection:"row",alignItems:"center"}});return t.createElement(g,{style:y.container},t.createElement(k,{disabled:Boolean(i),value:i||"",onChange:u=>c(u),title:"Account Token"}),t.createElement(k,{onChange:u=>d(u),title:"Label"}),t.createElement(k,{onChange:u=>w(u),title:"Description"}),t.createElement(p,{label:()=>t.createElement(S,{adjustsFontSizeToFit:!0,style:y.colorText},"Color"),trailing:()=>t.createElement(g,{style:y.row},t.createElement(g,{style:[y.colorBlock,{backgroundColor:h}]}),t.createElement(S,{style:y.colorText},h),t.createElement(q,null)),onPress:()=>te({onSelect:u=>v(j.int2hex(u)),defaultColor:h})}),t.createElement(g,{style:y.row},t.createElement(H,{onPress:async function(){const u=l||await Q(a),P=e.get("accounts",[]);P.push({token:a,user:u,label:s||null,description:m||null,color:h||null}),e.set("accounts",P),o.goBack()},text:"Add account"})))}function ae({settings:e,navigation:o=T.useNavigation()}){return t.createElement(Be,{settings:e,navigation:o})}function G({name:e="pluginName",mainScreen:o=ae,addAccount:r=ce}={}){const i=L({container:{backgroundColor:R.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:R.BACKGROUND_MOBILE_PRIMARY,color:R.TEXT_NORMAL},header:{backgroundColor:R.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:R.HEADER_PRIMARY},close:{color:R.HEADER_PRIMARY}});return t.createElement(T.NavigationContainer,null,t.createElement(D.Navigator,{initialRouteName:e,style:i.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:i.cardStyle,headerStyle:i.header,headerTitleContainerStyle:i.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(D.Screen,{name:e,component:M(o,e),options:({navigation:l})=>({headerTitle:"Account Switcher",headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(Te,{color:i.close.color,title:"Close",onPress:()=>C.pop()}),headerRight:()=>t.createElement(re,{navigation:l}),...X.TransitionPresets.ModalSlideFromBottomIOS})}),t.createElement(D.Screen,{name:"AccountSwitcherAddAccount",component:M(r,e),options:{headerTitle:"Add account",headerTitleStyle:{color:"white"},headerTintColor:i.close.color}}),t.createElement(D.Screen,{name:"AccountSwitcherEditAccount",component:M(ie,e),options:{headerTitle:"Edit account",headerTitleStyle:{color:"white"},headerTintColor:i.close.color}})))}function _e(e){Ne(e),De(e)}function Ne(e){e.after(fe,"default",(o,r,i)=>({...i,AccountSwitcherMain:{key:"AccountSwitcherMain",title:"Account Switcher",render:M(ae,I.name),headerRight:re},AccountSwitcherAddAccount:{key:"AccountSwitcherAddAccount",title:"Add Account",render:M(ce,I.name)},AccountSwitcherEditAccount:{key:"AccountSwitcherEditAccount",title:"Edit Account",render:M(ie,I.name)}}))}function De(e){const o=ue("UserSettingsOverviewWrapper",{default:!1}),r=e.after(o,"default",(i,l,a)=>{e.after(a.type.prototype,"render",({props:{navigation:c}},s,d)=>{const{children:m}=d.props,w=m.findIndex(h=>E.Messages.LOGOUT===h.props.label);m[w].props.label="Account Switcher",m[w].props.onPress=()=>{c.navigate("AccountSwitcherMain")}}),r()})}function Le(e){const o=e.before(ee,"openLazy",({hideActionSheet:r},[i,l])=>{l==="StatusPicker"&&i.then(a=>{e.after(a,"default",(c,s,d)=>{const m=d.props.children[1].props.children.props.children;m.push({...m[0],props:{children:t.createElement(p,{leading:t.createElement(p.Icon,{source:A.Sort}),label:E.Messages.SWITCH_ACCOUNTS_MENU_ITEM_TITLE,trailing:p.Arrow,onPress:()=>{r(),C.push(G,{name:I.name})}})}})}),o()})})}const le=V("Welcome",{default:!1}),_=de("account-switcher"),Oe={...I,onStart(){_e(_),Le(_);const e=t.createElement(H,{onPress:()=>C.push(G,{name:this.name}),style:{marginBottom:0,backgroundColor:"#64d3ff"},text:"Account Switcher"});if(_.after(le,"default",(r,i,l)=>{const a=W(l,s=>{var d,m,w;return((w=(m=(d=s==null?void 0:s.children)==null?void 0:d[0])==null?void 0:m.type)==null?void 0:w.name)==="Button"});if(!a)return;const c=a.children[a.children.length-1].props.style;a.children[a.children.length-1].props.style=[...Array.isArray(c)?c:[c],{marginBottom:12}],a.children.push(e)}),Boolean(F.getToken()))return;const o=_.before(g,"render",(r,[i],l)=>{const a=W(i,c=>{var s;return((s=c==null?void 0:c.type)==null?void 0:s.name)==="Welcome"});!a||(a.type=le.default,o())})},onStop(){_.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(g,{onLayout:()=>{C.pop(),C.push(G,{name:I.name})}})}};se(Oe);
