function oe(e){window.enmity.plugins.registerPlugin(e)}function ie(e,i){return window.enmity.modules.getModule(e,i)}function re(...e){return window.enmity.modules.getByProps(...e)}function ae(...e){return window.enmity.modules.getByTypeName(...e)}function ce(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function se(e){return window.enmity.patcher.create(e)}var le="AccountSwitcher",me="1.0.1",de="Switch between multiple accounts.",ue="#64D3FF",ge=[{name:"ssense",id:"146080957965795328"}],I={name:le,version:me,description:de,color:ue,authors:ge};function j(e,i,n){return window.enmity.utilities.findInReactTree(e,i,n)}const D=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const H=window.enmity.modules.common.Toasts,$=window.enmity.modules.common.Dialog,S=window.enmity.modules.common.Token;window.enmity.modules.common.REST,window.enmity.modules.common.Settings;const V=window.enmity.modules.common.Users,v=window.enmity.modules.common.Navigation,he=window.enmity.modules.common.NavigationNative,z=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const P=window.enmity.modules.common.StyleSheet,O=window.enmity.modules.common.ColorMap;window.enmity.modules.common.Components;const R=window.enmity.modules.common.Locale,we=window.enmity.modules.common.Profiles;window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG;const ye=window.enmity.modules.common.Scenes,{components:o}=window.enmity,pe=o.Alert,Se=o.Button;o.FlatList;const L=o.Image;o.ImageBackground,o.KeyboardAvoidingView,o.Modal,o.Pressable;const Ae=o.RefreshControl,fe=o.ScrollView;o.SectionList,o.StatusBar,o.StyleSheet,o.Switch;const F=o.Text;o.TextInput,o.TouchableHighlight;const B=o.TouchableOpacity;o.TouchableWithoutFeedback,o.Touchable;const h=o.View;o.VirtualizedList,o.Form,o.FormArrow,o.FormCTA;const Ee=o.FormCTAButton;o.FormCardSection,o.FormCheckbox,o.FormDivider,o.FormHint,o.FormIcon;const y=o.FormInput;o.FormLabel,o.FormRadio;const A=o.FormRow;o.FormSection,o.FormSelect,o.FormSubLabel,o.FormSwitch,o.FormTernaryCheckBox,o.FormText,o.FormTextColors,o.FormTextSizes;function f(e){return window.enmity.assets.getIDByName(e)}const U=re("loginToken"),{default:Y}=ie(e=>e==null?void 0:e.ButtonColors),G=e=>e.id?{id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar,...e.email&&{email:e.email},...e.phone&&{phone:e.phone}}:{};async function W(e){const i=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return G(i)}const Ce=()=>{const e=()=>{U.logout()};$.show({isDismissable:!0,title:R.Messages.LOGOUT,body:R.Messages.USER_SETTINGS_CONFIRM_LOGOUT,confirmColor:"red",confirmText:R.Messages.LOGOUT,cancelText:R.Messages.CANCEL,onConfirm:e})},K=({title:e="Are you sure?",body:i,confirmColor:n,confirmText:r="Yes",cancelText:d="No",onConfirm:a,onCancel:s})=>{if(!S.getToken())return pe.alert(e,i,[{text:r,onPress:a},{text:d,onPress:s}]);$.show({isDismissable:!0,title:e,body:i,confirmColor:n,confirmText:r,cancelText:d,onConfirm:a,onCancel:s})},p={AddWhite:f("add_white"),Checkmark:f("Check"),Key:f("ic_authed_apps_24px"),MyAccount:f("ic_my_account_24px"),Passport:f("ic_passport_24px"),Settings:f("settings"),TrashFilled:f("ic_trash_filled_16px")};function b(e,i){return window.enmity.settings.connectComponent(e,i)}const{ThemeColorMap:X}=O;function Te({account:e}){if(!e)return null;const i=P.createThemedStyleSheet({linkless:{color:X.HEADER_SECONDARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,display:"flex",fontSize:16,alignItems:"center",alignSelf:"center",justifyContent:"center"},link:{color:X.HEADER_PRIMARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,display:"flex",alignItems:"center",fontSize:16,alignSelf:"center",justifyContent:"center"}});return t.createElement(h,null,(n=>typeof n=="string"?t.createElement(F,{style:i.linkless},n):typeof n=="object"&&n.username&&!n.id?t.createElement(F,{style:i.linkless},n.username):typeof n=="object"&&n.username&&n.id?t.createElement(B,{key:n.id,onPress:()=>we.showUserProfile({userId:n.id})},t.createElement(F,{style:i.link},n.username)):null)(e))}const{ThemeColorMap:M}=O;function ve({account:e,position:i,settings:n,navigation:r,isFromUserSettings:d}){var a,s;const c=P.createThemedStyleSheet({container:{backgroundColor:M.BACKGROUND_SECONDARY,borderRadius:5,borderLeftColor:(a=e.color)!=null?a:"#524FBF",borderLeftWidth:5,marginBottom:15},name:{color:M.HEADER_PRIMARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,fontSize:16},content:{height:"auto",paddingBottom:10,paddingLeft:10,paddingRight:10},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},description:{color:M.HEADER_SECONDARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD},info:{marginLeft:-6,flexDirection:"row",alignItems:"center",flexWrap:"wrap",width:"100%"},delete:{marginRight:7.5},trashIcon:{width:22,height:22,tintColor:M.INTERACTIVE_NORMAL},settingsIcon:{width:22,height:22,tintColor:M.INTERACTIVE_NORMAL}});return t.createElement(B,{style:c.container,onPress:()=>{const u=()=>{v.popAll(),U.loginToken(e.token),H.open({content:"Account Switched",source:p.Checkmark})};K({body:`Switch to ${e.label||e.user.username+"#"+e.user.discriminator}?`,onConfirm:u})}},t.createElement(h,null,t.createElement(A,{label:()=>t.createElement(h,{style:c.info},e.label&&t.createElement(F,{adjustsFontSizeToFit:!0,style:c.name},`${e.label} ( `),t.createElement(Te,{account:e.user}),e.label&&t.createElement(F,{adjustsFontSizeToFit:!0,style:c.name}," )")),trailing:()=>t.createElement(h,{style:c.actions},t.createElement(B,{style:c.delete,onPress:()=>{r.navigate("AccountSwitcherEditAccount",d?{navigation:r,route:{params:{account:e,position:i}},isFromUserSettings:d}:{account:e,position:i})}},t.createElement(L,{style:c.settingsIcon,source:p.Settings})),t.createElement(B,{style:c.delete,onPress:()=>{const u=()=>{const l=n.get("accounts",[]);l.splice(i,1),n.set("accounts",l),H.open({content:"Account Deleted",source:p.Checkmark})};K({body:e.label?`Delete ${e.label} (${e.user.username}#${e.user.discriminator})?`:`Delete ${e.user.username}#${e.user.discriminator}?`,confirmColor:"red",onConfirm:u})}},t.createElement(L,{style:c.trashIcon,source:p.TrashFilled})))})),t.createElement(h,{style:c.content},t.createElement(F,{style:c.description},(s=e.description)!=null?s:`ID: ${e.user.id}`)))}const{createThemedStyleSheet:Re}=P;var Fe=({settings:e,navigation:i,isFromUserSettings:n})=>{const[r,d]=t.useState(!1),a=()=>{const l=e.get("accounts",[]);return Array.isArray(l)&&l.sort((g,w)=>{var C,T;return((C=g.label)==null?void 0:C.localeCompare(w.label))||((T=g.username)==null?void 0:T.localeCompare(w.username))})},[s,c]=t.useState(a()),u=Re({container:{flex:1,padding:5}});return t.createElement(t.Fragment,null,t.createElement(h,{style:u.container},t.createElement(fe,{style:u.container,refreshControl:t.createElement(Ae,{refreshing:r,onRefresh:()=>{d(!0),c(a()),d(!1)}})},Array.isArray(s)&&s.map((l,g)=>t.createElement(ve,{account:l,position:g,settings:e,navigation:i,isFromUserSettings:n!=null?n:void 0})),t.createElement(A,{label:"Add Account (Token)",leading:t.createElement(A.Icon,{source:p.Key}),onPress:()=>{i.navigate("AccountSwitcherAddAccount",n&&{navigation:i,isFromUserSettings:n})}}),Boolean(S.getToken())&&t.createElement(A,{label:"Add Current Account",leading:t.createElement(A.Icon,{source:p.MyAccount}),onPress:()=>{i.navigate("AccountSwitcherAddAccount",n?{navigation:i,route:{params:{token:S.getToken(),user:G(V.getCurrentUser())}},isFromUserSettings:n}:{token:S.getToken(),user:G(V.getCurrentUser())})}}),t.createElement(A,{label:"Add Account (User/Pass)",leading:t.createElement(A.Icon,{source:p.Passport}),onPress:()=>{Boolean(S.getToken())&&U.loginToken(""),v.popAll()}}),Boolean(S.getToken())&&t.createElement(Ee,{color:"danger",label:R.Messages.LOGOUT,onPress:Ce}))))};const x=z.createStackNavigator(),{createThemedStyleSheet:N}=P,{ThemeColorMap:E}=O;function q({navigation:e,isFromUserSettings:i}){const n=N({header:{tintColor:E.HEADER_PRIMARY,marginRight:15,width:18,height:18},wrapper:{marginRight:15,width:32,height:32}});return t.createElement(B,{styles:n.wrapper,onPress:()=>{e.navigate("AccountSwitcherAddAccount",i&&{navigation:e,isFromUserSettings:i})}},t.createElement(L,{style:n.header,source:p.AddWhite}))}function J({settings:e,navigation:i,route:n}){const{account:r,position:d}=n.params,[a,s]=t.useState(r.token),[c,u]=t.useState(r.label||""),[l,g]=t.useState(r.description||""),[w,C]=t.useState(r.color||""),T=N({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:T.container},t.createElement(y,{value:a,onChange:m=>s(m),title:"Account Token"}),t.createElement(y,{value:c,onChange:m=>u(m),title:"Label"}),t.createElement(y,{value:l,onChange:m=>g(m),title:"Description"}),t.createElement(y,{value:w,onChange:m=>C(m),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(Y,{onPress:async function(){const m=await W(a),k=e.get("accounts",[]);k[d]={token:a,user:m,label:c||null,description:l||null,color:w||null},e.set("accounts",k),i.goBack()},style:{backgroundColor:"#64d3ff"},text:"Save account"})))}function Q({settings:e,navigation:i,route:n}){const{token:r,user:d}=(n==null?void 0:n.params)||{},[a,s]=t.useState(r||""),[c,u]=t.useState(""),[l,g]=t.useState(""),[w,C]=t.useState(""),T=N({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:T.container},t.createElement(y,{disabled:Boolean(r),value:r||"",onChange:m=>s(m),title:"Account Token"}),t.createElement(y,{onChange:m=>u(m),title:"Label"}),t.createElement(y,{onChange:m=>g(m),title:"Description"}),t.createElement(y,{value:w,onChange:m=>C(m),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(Y,{onPress:async function(){const m=d||await W(a),k=e.get("accounts",[]);k.push({token:a,user:m,label:c||null,description:l||null,color:w||null}),e.set("accounts",k),i.goBack()},style:{backgroundColor:"#64d3ff"},text:"Add account"})))}function Z({settings:e,navigation:i,isFromUserSettings:n}){return t.createElement(Fe,{settings:e,navigation:i,isFromUserSettings:n!=null?n:void 0})}function ee({name:e="pluginName",mainScreen:i=Z,addAccount:n=Q}={}){const r=N({container:{backgroundColor:E.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:E.BACKGROUND_MOBILE_PRIMARY,color:E.TEXT_NORMAL},header:{backgroundColor:E.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:E.HEADER_PRIMARY},close:{color:E.HEADER_PRIMARY}});return t.createElement(he.NavigationContainer,null,t.createElement(x.Navigator,{initialRouteName:e,style:r.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:r.cardStyle,headerStyle:r.header,headerTitleContainerStyle:r.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(x.Screen,{name:e,component:b(i,e),options:({navigation:d})=>({headerTitle:"Account Switcher",headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(Se,{color:r.close.color,title:"Close",onPress:()=>v.pop()}),headerRight:()=>t.createElement(q,{navigation:d,isFromUserSettings:void 0}),...z.TransitionPresets.ModalSlideFromBottomIOS})}),t.createElement(x.Screen,{name:"AccountSwitcherAddAccount",component:b(n,e),options:{headerTitle:"Add account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}}),t.createElement(x.Screen,{name:"AccountSwitcherEditAccount",component:b(J,e),options:{headerTitle:"Edit account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}})))}function be(e){ke(e),Ie(e)}const te={navigation:{}};function ke(e){e.after(ye,"default",(i,n,r)=>({...r,AccountSwitcherMain:{key:"AccountSwitcherMain",title:"Account Switcher",render:b(Z,I.name),headerRight:()=>t.createElement(q,{navigation:te.navigation,isFromUserSettings:!0})},AccountSwitcherAddAccount:{key:"AccountSwitcherAddAccount",title:"Add Account",render:b(Q,I.name)},AccountSwitcherEditAccount:{key:"AccountSwitcherEditAccount",title:"Edit Account",render:b(J,I.name)}}))}function Ie(e){const i=ae("UserSettingsOverviewWrapper",{default:!1}),n=e.after(i,"default",(r,d,a)=>{e.after(a.type.prototype,"render",({props:{navigation:s}},c,u)=>{const{children:l}=u.props,g=l.findIndex(w=>R.Messages.LOGOUT===w.props.label);l[g].props.label="Account Switcher",l[g].props.onPress=()=>{s.navigate("AccountSwitcherMain",{navigation:s,isFromUserSettings:!0})},te.navigation=s}),n()})}const ne=ce("Welcome",{default:!1}),_=se("account-switcher"),Be={...I,onStart(){be(_);const e=t.createElement(Y,{onPress:()=>v.push(ee,{name:this.name}),style:{marginBottom:0,backgroundColor:"#64d3ff"},text:"Account Switcher"});if(_.after(ne,"default",(n,r,d)=>{const a=j(d,c=>{var u,l,g;return((g=(l=(u=c==null?void 0:c.children)==null?void 0:u[0])==null?void 0:l.type)==null?void 0:g.name)==="Button"});if(!a)return;const s=a.children[a.children.length-1].props.style;a.children[a.children.length-1].props.style=[...Array.isArray(s)?s:[s],{marginBottom:12}],a.children.push(e)}),Boolean(S.getToken()))return;const i=_.before(h,"render",(n,[r],d)=>{const a=j(r,s=>{var c;return((c=s==null?void 0:s.type)==null?void 0:c.name)==="Welcome"});!a||(a.type=ne.default,i())})},onStop(){_.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(h,{onLayout:()=>{v.pop(),v.push(ee,{name:I.name})}})}};oe(Be);
