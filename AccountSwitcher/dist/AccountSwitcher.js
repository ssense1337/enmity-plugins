function ne(e){window.enmity.plugins.registerPlugin(e)}function oe(e,n){return window.enmity.modules.getModule(e,n)}function ie(...e){return window.enmity.modules.getByProps(...e)}function re(...e){return window.enmity.modules.getByTypeName(...e)}function ae(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function ce(e){return window.enmity.patcher.create(e)}var se="AccountSwitcher",le="1.0.0",me="Switch between multiple accounts.",de="#64D3FF",ue=[{name:"ssense",id:"146080957965795328"}],I={name:se,version:le,description:me,color:de,authors:ue};function G(e,n,o){return window.enmity.utilities.findInReactTree(e,n,o)}const D=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const $=window.enmity.modules.common.Toasts,j=window.enmity.modules.common.Dialog,S=window.enmity.modules.common.Token;window.enmity.modules.common.REST,window.enmity.modules.common.Settings;const H=window.enmity.modules.common.Users,v=window.enmity.modules.common.Navigation,ge=window.enmity.modules.common.NavigationNative,V=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const P=window.enmity.modules.common.StyleSheet,O=window.enmity.modules.common.ColorMap;window.enmity.modules.common.Components;const R=window.enmity.modules.common.Locale,he=window.enmity.modules.common.Profiles;window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG;const ye=window.enmity.modules.common.Scenes,{components:i}=window.enmity,we=i.Alert,pe=i.Button;i.FlatList;const L=i.Image;i.ImageBackground,i.KeyboardAvoidingView,i.Modal,i.Pressable;const Se=i.RefreshControl,Ae=i.ScrollView;i.SectionList,i.StatusBar,i.StyleSheet,i.Switch;const b=i.Text;i.TextInput,i.TouchableHighlight;const B=i.TouchableOpacity;i.TouchableWithoutFeedback,i.Touchable;const h=i.View;i.VirtualizedList,i.Form,i.FormArrow,i.FormCTA;const fe=i.FormCTAButton;i.FormCardSection,i.FormCheckbox,i.FormDivider,i.FormHint,i.FormIcon;const w=i.FormInput;i.FormLabel,i.FormRadio;const A=i.FormRow;i.FormSection,i.FormSelect,i.FormSubLabel,i.FormSwitch,i.FormTernaryCheckBox,i.FormText,i.FormTextColors,i.FormTextSizes;function f(e){return window.enmity.assets.getIDByName(e)}const U=ie("loginToken"),{default:Y}=oe(e=>e==null?void 0:e.ButtonColors);async function z(e){const n=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return n.id?{id:n.id,username:n.username,discriminator:n.discriminator,avatar:n.avatar,...n.email&&{email:n.email},...n.phone&&{phone:n.phone}}:{}}const Ee=()=>{const e=()=>{U.logout()};j.show({isDismissable:!0,title:R.Messages.LOGOUT,body:R.Messages.USER_SETTINGS_CONFIRM_LOGOUT,confirmColor:"red",confirmText:R.Messages.LOGOUT,cancelText:R.Messages.CANCEL,onConfirm:e})},W=({title:e="Are you sure?",body:n,confirmColor:o,confirmText:r="Yes",cancelText:d="No",onConfirm:a,onCancel:s})=>{if(!S.getToken())return we.alert(e,n,[{text:r,onPress:a},{text:d,onPress:s}]);j.show({isDismissable:!0,title:e,body:n,confirmColor:o,confirmText:r,cancelText:d,onConfirm:a,onCancel:s})},p={AddWhite:f("add_white"),Checkmark:f("Check"),Key:f("ic_authed_apps_24px"),MyAccount:f("ic_my_account_24px"),Passport:f("ic_passport_24px"),Settings:f("settings"),TrashFilled:f("ic_trash_filled_16px")};function F(e,n){return window.enmity.settings.connectComponent(e,n)}const{ThemeColorMap:K}=O;function Ce({account:e}){if(!e)return null;const n=P.createThemedStyleSheet({linkless:{color:K.HEADER_SECONDARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,display:"flex",fontSize:16,alignItems:"center",alignSelf:"center",justifyContent:"center"},link:{color:K.HEADER_PRIMARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,display:"flex",alignItems:"center",fontSize:16,alignSelf:"center",justifyContent:"center"}});return t.createElement(h,null,(o=>typeof o=="string"?t.createElement(b,{style:n.linkless},o):typeof o=="object"&&o.username&&!o.id?t.createElement(b,{style:n.linkless},o.username):typeof o=="object"&&o.username&&o.id?t.createElement(B,{key:o.id,onPress:()=>he.showUserProfile({userId:o.id})},t.createElement(b,{style:n.link},o.username)):null)(e))}const{ThemeColorMap:M}=O;function Te({account:e,position:n,settings:o,navigation:r,isFromUserSettings:d}){var a,s;const c=P.createThemedStyleSheet({container:{backgroundColor:M.BACKGROUND_SECONDARY,borderRadius:5,borderLeftColor:(a=e.color)!=null?a:"#524FBF",borderLeftWidth:5,marginBottom:15},name:{color:M.HEADER_PRIMARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,fontSize:16},content:{height:"auto",paddingBottom:10,paddingLeft:10,paddingRight:10},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},description:{color:M.HEADER_SECONDARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD},info:{marginLeft:-6,flexDirection:"row",alignItems:"center",flexWrap:"wrap",width:"100%"},delete:{marginRight:7.5},trashIcon:{width:22,height:22,tintColor:M.INTERACTIVE_NORMAL},settingsIcon:{width:22,height:22,tintColor:M.INTERACTIVE_NORMAL}});return t.createElement(B,{style:c.container,onPress:()=>{const u=()=>{v.popAll(),U.loginToken(e.token),$.open({content:"Account Switched",source:p.Checkmark})};W({body:`Switch to ${e.label||e.user.username+"#"+e.user.discriminator}?`,onConfirm:u})}},t.createElement(h,null,t.createElement(A,{label:()=>t.createElement(h,{style:c.info},e.label&&t.createElement(b,{adjustsFontSizeToFit:!0,style:c.name},`${e.label} ( `),t.createElement(Ce,{account:e.user}),e.label&&t.createElement(b,{adjustsFontSizeToFit:!0,style:c.name}," )")),trailing:()=>t.createElement(h,{style:c.actions},t.createElement(B,{style:c.delete,onPress:()=>{r.navigate("AccountSwitcherEditAccount",d?{navigation:r,route:{params:{account:e,position:n}},isFromUserSettings:d}:{account:e,position:n})}},t.createElement(L,{style:c.settingsIcon,source:p.Settings})),t.createElement(B,{style:c.delete,onPress:()=>{const u=()=>{const l=o.get("accounts",[]);l.splice(n,1),o.set("accounts",l),$.open({content:"Account Deleted",source:p.Checkmark})};W({body:e.label?`Delete ${e.label} (${e.user.username}#${e.user.discriminator})?`:`Delete ${e.user.username}#${e.user.discriminator}?`,confirmColor:"red",onConfirm:u})}},t.createElement(L,{style:c.trashIcon,source:p.TrashFilled})))})),t.createElement(h,{style:c.content},t.createElement(b,{style:c.description},(s=e.description)!=null?s:`ID: ${e.user.id}`)))}const{createThemedStyleSheet:ve}=P;var Re=({settings:e,navigation:n,isFromUserSettings:o})=>{const[r,d]=t.useState(!1),a=()=>{const l=e.get("accounts",[]);return Array.isArray(l)&&l.sort((g,y)=>{var C,T;return g.label&&y.label?g.label.localeCompare(y.label):(T=(C=g.username)==null?void 0:C.localeCompare(y.username))!=null?T:1})},[s,c]=t.useState(a()),u=ve({container:{flex:1,padding:5}});return t.createElement(t.Fragment,null,t.createElement(h,{style:u.container},t.createElement(Ae,{style:u.container,refreshControl:t.createElement(Se,{refreshing:r,onRefresh:()=>{d(!0),c(a()),d(!1)}})},Array.isArray(s)&&s.map((l,g)=>t.createElement(Te,{account:l,position:g,settings:e,navigation:n,isFromUserSettings:o!=null?o:void 0})),t.createElement(A,{label:"Add Account (Token)",leading:t.createElement(A.Icon,{source:p.Key}),onPress:()=>{n.navigate("AccountSwitcherAddAccount",o&&{navigation:n,isFromUserSettings:o})}}),Boolean(S.getToken())&&t.createElement(A,{label:"Add Current Account",leading:t.createElement(A.Icon,{source:p.MyAccount}),onPress:()=>{n.navigate("AccountSwitcherAddAccount",o?{navigation:n,route:{params:{token:S.getToken(),user:H.getCurrentUser()}},isFromUserSettings:o}:{token:S.getToken(),user:H.getCurrentUser()})}}),t.createElement(A,{label:"Add Account (User/Pass)",leading:t.createElement(A.Icon,{source:p.Passport}),onPress:()=>{Boolean(S.getToken())&&U.loginToken(""),v.popAll()}}),Boolean(S.getToken())&&t.createElement(fe,{color:"danger",label:R.Messages.LOGOUT,onPress:Ee}))))};const N=V.createStackNavigator(),{createThemedStyleSheet:x}=P,{ThemeColorMap:E}=O;function X({navigation:e,isFromUserSettings:n}){const o=x({header:{tintColor:E.HEADER_PRIMARY,marginRight:15,width:18,height:18},wrapper:{marginRight:15,width:32,height:32}});return t.createElement(B,{styles:o.wrapper,onPress:()=>{e.navigate("AccountSwitcherAddAccount",n&&{navigation:e,isFromUserSettings:n})}},t.createElement(L,{style:o.header,source:p.AddWhite}))}function q({settings:e,navigation:n,route:o}){const{account:r,position:d}=o.params,[a,s]=t.useState(r.token),[c,u]=t.useState(r.label||""),[l,g]=t.useState(r.description||""),[y,C]=t.useState(r.color||""),T=x({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:T.container},t.createElement(w,{value:a,onChange:m=>s(m),title:"Account Token"}),t.createElement(w,{value:c,onChange:m=>u(m),title:"Label"}),t.createElement(w,{value:l,onChange:m=>g(m),title:"Description"}),t.createElement(w,{value:y,onChange:m=>C(m),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(Y,{onPress:async function(){const m=await z(a),k=e.get("accounts",[]);k[d]={token:a,user:m,label:c||null,description:l||null,color:y||null},e.set("accounts",k),n.goBack()},style:{backgroundColor:"#64d3ff"},text:"Save account"})))}function J({settings:e,navigation:n,route:o}){const{token:r,user:d}=(o==null?void 0:o.params)||{},[a,s]=t.useState(r||""),[c,u]=t.useState(""),[l,g]=t.useState(""),[y,C]=t.useState(""),T=x({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:T.container},t.createElement(w,{value:r||"",onChange:m=>s(m),title:"Account Token"}),t.createElement(w,{onChange:m=>u(m),title:"Label"}),t.createElement(w,{onChange:m=>g(m),title:"Description"}),t.createElement(w,{value:y,onChange:m=>C(m),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(Y,{onPress:async function(){const m=d||await z(a),k=e.get("accounts",[]);k.push({token:a,user:m,label:c||null,description:l||null,color:y||null}),e.set("accounts",k),n.goBack()},style:{backgroundColor:"#64d3ff"},text:"Add account"})))}function Q({settings:e,navigation:n,isFromUserSettings:o}){return t.createElement(Re,{settings:e,navigation:n,isFromUserSettings:o!=null?o:void 0})}function Z({name:e="pluginName",mainScreen:n=Q,addAccount:o=J}={}){const r=x({container:{backgroundColor:E.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:E.BACKGROUND_MOBILE_PRIMARY,color:E.TEXT_NORMAL},header:{backgroundColor:E.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:E.HEADER_PRIMARY},close:{color:E.HEADER_PRIMARY}});return t.createElement(ge.NavigationContainer,null,t.createElement(N.Navigator,{initialRouteName:e,style:r.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:r.cardStyle,headerStyle:r.header,headerTitleContainerStyle:r.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(N.Screen,{name:e,component:F(n,e),options:({navigation:d})=>({headerTitle:"Account Switcher",headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(pe,{color:r.close.color,title:"Close",onPress:()=>v.pop()}),headerRight:()=>t.createElement(X,{navigation:d,isFromUserSettings:void 0}),...V.TransitionPresets.ModalSlideFromBottomIOS})}),t.createElement(N.Screen,{name:"AccountSwitcherAddAccount",component:F(o,e),options:{headerTitle:"Add account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}}),t.createElement(N.Screen,{name:"AccountSwitcherEditAccount",component:F(q,e),options:{headerTitle:"Edit account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}})))}function be(e){Fe(e),ke(e)}const ee={navigation:{}};function Fe(e){e.after(ye,"default",(n,o,r)=>({...r,AccountSwitcherMain:{key:"AccountSwitcherMain",title:"Account Switcher",render:F(Q,I.name),headerRight:()=>t.createElement(X,{navigation:ee.navigation,isFromUserSettings:!0})},AccountSwitcherAddAccount:{key:"AccountSwitcherAddAccount",title:"Add Account",render:F(J,I.name)},AccountSwitcherEditAccount:{key:"AccountSwitcherEditAccount",title:"Edit Account",render:F(q,I.name)}}))}function ke(e){const n=re("UserSettingsOverviewWrapper",{default:!1}),o=e.after(n,"default",(r,d,a)=>{e.after(a.type.prototype,"render",({props:{navigation:s}},c,u)=>{const{children:l}=u.props,g=l.findIndex(y=>R.Messages.LOGOUT===y.props.label);l[g].props.label="Account Switcher",l[g].props.onPress=()=>{s.navigate("AccountSwitcherMain",{navigation:s,isFromUserSettings:!0})},ee.navigation=s}),o()})}const te=ae("Welcome",{default:!1}),_=ce("account-switcher"),Ie={...I,onStart(){be(_);const e=t.createElement(Y,{onPress:()=>v.push(Z,{name:this.name}),style:{marginBottom:0,backgroundColor:"#64d3ff"},text:"Account Switcher"});if(_.after(te,"default",(o,r,d)=>{const a=G(d,c=>{var u,l,g;return((g=(l=(u=c==null?void 0:c.children)==null?void 0:u[0])==null?void 0:l.type)==null?void 0:g.name)==="Button"});if(!a)return;const s=a.children[a.children.length-1].props.style;a.children[a.children.length-1].props.style=[...Array.isArray(s)?s:[s],{marginBottom:12}],a.children.push(e)}),Boolean(S.getToken()))return;const n=_.before(h,"render",(o,[r],d)=>{const a=G(r,s=>{var c;return((c=s==null?void 0:s.type)==null?void 0:c.name)==="Welcome"});!a||(a.type=te.default,n())})},onStop(){_.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(h,{onLayout:()=>{v.pop(),v.push(Z,{name:I.name})}})}};ne(Ie);
