function ne(e){window.enmity.plugins.registerPlugin(e)}function oe(e,n){return window.enmity.modules.getModule(e,n)}function ie(...e){return window.enmity.modules.getByProps(...e)}function re(...e){return window.enmity.modules.getByTypeName(...e)}function ae(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function ce(e){return window.enmity.patcher.create(e)}var se="AccountSwitcher",le="1.0.0",me="Switch between multiple accounts.",ue="#64D3FF",de=[{name:"ssense",id:"146080957965795328"}],F={name:se,version:le,description:me,color:ue,authors:de};function Y(e,n,o){return window.enmity.utilities.findInReactTree(e,n,o)}const B=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const G=window.enmity.modules.common.Toasts,$=window.enmity.modules.common.Dialog,p=window.enmity.modules.common.Token;window.enmity.modules.common.REST,window.enmity.modules.common.Settings;const j=window.enmity.modules.common.Users,C=window.enmity.modules.common.Navigation,ge=window.enmity.modules.common.NavigationNative,H=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const D=window.enmity.modules.common.StyleSheet,O=window.enmity.modules.common.ColorMap;window.enmity.modules.common.Components;const T=window.enmity.modules.common.Locale,he=window.enmity.modules.common.Profiles;window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG;const we=window.enmity.modules.common.Scenes,{components:i}=window.enmity,ye=i.Alert,pe=i.Button;i.FlatList;const L=i.Image;i.ImageBackground,i.KeyboardAvoidingView,i.Modal,i.Pressable;const Se=i.RefreshControl,fe=i.ScrollView;i.SectionList,i.StatusBar,i.StyleSheet,i.Switch;const v=i.Text;i.TextInput,i.TouchableHighlight;const k=i.TouchableOpacity;i.TouchableWithoutFeedback,i.Touchable;const h=i.View;i.VirtualizedList,i.Form,i.FormArrow,i.FormCTA;const Ae=i.FormCTAButton;i.FormCardSection,i.FormCheckbox,i.FormDivider,i.FormHint,i.FormIcon;const y=i.FormInput;i.FormLabel,i.FormRadio;const S=i.FormRow;i.FormSection,i.FormSelect,i.FormSubLabel,i.FormSwitch,i.FormTernaryCheckBox,i.FormText,i.FormTextColors,i.FormTextSizes;const U=ie("loginToken"),{default:_}=oe(e=>e==null?void 0:e.ButtonColors);async function V(e){const n=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return n.id?{id:n.id,username:n.username,discriminator:n.discriminator,avatar:n.avatar,...n.email&&{email:n.email},...n.phone&&{phone:n.phone}}:{}}const Ee=()=>{const e=()=>{U.logout()};$.show({isDismissable:!0,title:T.Messages.LOGOUT,body:T.Messages.USER_SETTINGS_CONFIRM_LOGOUT,confirmColor:"red",confirmText:T.Messages.LOGOUT,cancelText:T.Messages.CANCEL,onConfirm:e})},z=({title:e="Are you sure?",body:n,confirmColor:o,confirmText:r="Yes",cancelText:u="No",onConfirm:a,onCancel:s})=>{if(!p.getToken())return ye.alert(e,n,[{text:r,onPress:a},{text:u,onPress:s}]);$.show({isDismissable:!0,title:e,body:n,confirmColor:o,confirmText:r,cancelText:u,onConfirm:a,onCancel:s})};function M(e){return window.enmity.assets.getIDByName(e)}function R(e,n){return window.enmity.settings.connectComponent(e,n)}const{ThemeColorMap:W}=O;function Ce({account:e}){if(!e)return null;const n=D.createThemedStyleSheet({linkless:{color:W.HEADER_SECONDARY,fontFamily:B.Fonts.PRIMARY_SEMIBOLD,display:"flex",fontSize:16,alignItems:"center",alignSelf:"center",justifyContent:"center"},link:{color:W.HEADER_PRIMARY,fontFamily:B.Fonts.PRIMARY_SEMIBOLD,display:"flex",alignItems:"center",fontSize:16,alignSelf:"center",justifyContent:"center"}});return t.createElement(h,null,(o=>typeof o=="string"?t.createElement(v,{style:n.linkless},o):typeof o=="object"&&o.username&&!o.id?t.createElement(v,{style:n.linkless},o.username):typeof o=="object"&&o.username&&o.id?t.createElement(k,{key:o.id,onPress:()=>he.showUserProfile({userId:o.id})},t.createElement(v,{style:n.link},o.username)):null)(e))}const K={Checkmark:M("Check")},{ThemeColorMap:I}=O;function Te({account:e,position:n,settings:o,navigation:r,isFromUserSettings:u}){var a,s;const c=D.createThemedStyleSheet({container:{backgroundColor:I.BACKGROUND_SECONDARY,borderRadius:5,borderLeftColor:(a=e.color)!=null?a:"#524FBF",borderLeftWidth:5,marginBottom:15},name:{color:I.HEADER_PRIMARY,fontFamily:B.Fonts.PRIMARY_SEMIBOLD,fontSize:16},content:{height:"auto",paddingBottom:10,paddingLeft:10,paddingRight:10},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},description:{color:I.HEADER_SECONDARY,fontFamily:B.Fonts.PRIMARY_SEMIBOLD},info:{marginLeft:-6,flexDirection:"row",alignItems:"center",flexWrap:"wrap",width:"100%"},delete:{marginRight:7.5},trashIcon:{width:22,height:22,tintColor:I.INTERACTIVE_NORMAL},settingsIcon:{width:22,height:22,tintColor:I.INTERACTIVE_NORMAL}});return t.createElement(k,{style:c.container,onPress:()=>{const d=()=>{C.popAll(),U.loginToken(e.token),G.open({content:"Account Switched",source:K.Checkmark})};z({body:`Switch to ${e.label||e.user.username+"#"+e.user.discriminator}?`,onConfirm:d})}},t.createElement(h,null,t.createElement(S,{label:()=>t.createElement(h,{style:c.info},e.label&&t.createElement(v,{adjustsFontSizeToFit:!0,style:c.name},`${e.label} ( `),t.createElement(Ce,{account:e.user}),e.label&&t.createElement(v,{adjustsFontSizeToFit:!0,style:c.name}," )")),trailing:()=>t.createElement(h,{style:c.actions},t.createElement(k,{style:c.delete,onPress:()=>{r.navigate("AccountSwitcherEditAccount",u?{navigation:r,route:{params:{account:e,position:n}},isFromUserSettings:u}:{account:e,position:n})}},t.createElement(L,{style:c.settingsIcon,source:M("settings")})),t.createElement(k,{style:c.delete,onPress:()=>{const d=()=>{const l=o.get("accounts",[]);l.splice(n,1),o.set("accounts",l),G.open({content:"Account Deleted",source:K.Checkmark})};z({body:e.label?`Delete ${e.label} (${e.user.username}#${e.user.discriminator})?`:`Delete ${e.user.username}#${e.user.discriminator}?`,confirmColor:"red",onConfirm:d})}},t.createElement(L,{style:c.trashIcon,source:M("ic_trash_filled_16px")})))})),t.createElement(h,{style:c.content},t.createElement(v,{style:c.description},(s=e.description)!=null?s:`ID: ${e.user.id}`)))}const{createThemedStyleSheet:ve}=D;var Re=({settings:e,navigation:n,isFromUserSettings:o})=>{const[r,u]=t.useState(!1),a=()=>{const l=e.get("accounts",[]);return Array.isArray(l)&&l.sort((g,w)=>{var A,E;return g.label&&w.label?g.label.localeCompare(w.label):(E=(A=g.username)==null?void 0:A.localeCompare(w.username))!=null?E:1})},[s,c]=t.useState(a()),d=ve({container:{flex:1,padding:5}});return t.createElement(t.Fragment,null,t.createElement(h,{style:d.container},t.createElement(fe,{style:d.container,refreshControl:t.createElement(Se,{refreshing:r,onRefresh:()=>{u(!0),c(a()),u(!1)}})},Array.isArray(s)&&s.map((l,g)=>t.createElement(Te,{account:l,position:g,settings:e,navigation:n,isFromUserSettings:o!=null?o:void 0})),t.createElement(S,{label:"Add Account (Token)",leading:t.createElement(S.Icon,{source:{uri:"https://files.enmity.app/icon-64.png"}}),onPress:()=>{n.navigate("AccountSwitcherAddAccount",o&&{navigation:n,isFromUserSettings:o})}}),Boolean(p.getToken())&&t.createElement(S,{label:"Add Current Account",leading:t.createElement(S.Icon,{source:{uri:"https://files.enmity.app/icon-64.png"}}),onPress:()=>{n.navigate("AccountSwitcherAddAccount",o?{navigation:n,route:{params:{token:p.getToken(),user:j.getCurrentUser()}},isFromUserSettings:o}:{token:p.getToken(),user:j.getCurrentUser()})}}),t.createElement(S,{label:"Add Account (User/Pass)",leading:t.createElement(S.Icon,{source:{uri:"https://files.enmity.app/icon-64.png"}}),onPress:()=>{Boolean(p.getToken())&&U.loginToken(""),C.popAll()}}),Boolean(p.getToken())&&t.createElement(Ae,{color:"danger",label:T.Messages.LOGOUT,onPress:Ee}))))};const N=H.createStackNavigator(),{createThemedStyleSheet:P}=D,{ThemeColorMap:f}=O;function X({navigation:e,isFromUserSettings:n}){const o=P({header:{tintColor:f.HEADER_PRIMARY,marginRight:15,width:18,height:18},wrapper:{marginRight:15,width:32,height:32}});return t.createElement(k,{styles:o.wrapper,onPress:()=>{e.navigate("AccountSwitcherAddAccount",n&&{navigation:e,isFromUserSettings:n})}},t.createElement(L,{style:o.header,source:M("add_white")}))}function q({settings:e,navigation:n,route:o}){const{account:r,position:u}=o.params,[a,s]=t.useState(r.token),[c,d]=t.useState(r.label||""),[l,g]=t.useState(r.description||""),[w,A]=t.useState(r.color||""),E=P({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:E.container},t.createElement(y,{value:a,onChange:m=>s(m),title:"Account Token"}),t.createElement(y,{value:c,onChange:m=>d(m),title:"Label"}),t.createElement(y,{value:l,onChange:m=>g(m),title:"Description"}),t.createElement(y,{value:w,onChange:m=>A(m),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(_,{onPress:async function(){const m=await V(a),b=e.get("accounts",[]);b[u]={token:a,user:m,label:c||null,description:l||null,color:w||null},e.set("accounts",b),n.goBack()},style:{backgroundColor:"#64d3ff"},text:"Save account"})))}function J({settings:e,navigation:n,route:o}){const{token:r,user:u}=(o==null?void 0:o.params)||{},[a,s]=t.useState(r||""),[c,d]=t.useState(""),[l,g]=t.useState(""),[w,A]=t.useState(""),E=P({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:E.container},t.createElement(y,{value:r||"",onChange:m=>s(m),title:"Account Token"}),t.createElement(y,{onChange:m=>d(m),title:"Label"}),t.createElement(y,{onChange:m=>g(m),title:"Description"}),t.createElement(y,{value:w,onChange:m=>A(m),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(_,{onPress:async function(){const m=u||await V(a),b=e.get("accounts",[]);b.push({token:a,user:m,label:c||null,description:l||null,color:w||null}),e.set("accounts",b),n.goBack()},style:{backgroundColor:"#64d3ff"},text:"Add account"})))}function Q({settings:e,navigation:n,isFromUserSettings:o}){return t.createElement(Re,{settings:e,navigation:n,isFromUserSettings:o!=null?o:void 0})}function Z({name:e="pluginName",mainScreen:n=Q,addAccount:o=J}={}){const r=P({container:{backgroundColor:f.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:f.BACKGROUND_MOBILE_PRIMARY,color:f.TEXT_NORMAL},header:{backgroundColor:f.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:f.HEADER_PRIMARY},close:{color:f.HEADER_PRIMARY}});return t.createElement(ge.NavigationContainer,null,t.createElement(N.Navigator,{initialRouteName:e,style:r.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:r.cardStyle,headerStyle:r.header,headerTitleContainerStyle:r.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(N.Screen,{name:e,component:R(n,e),options:({navigation:u})=>({headerTitle:"Account Switcher",headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(pe,{color:r.close.color,title:"Close",onPress:()=>C.pop()}),headerRight:()=>t.createElement(X,{navigation:u,isFromUserSettings:void 0}),...H.TransitionPresets.ModalSlideFromBottomIOS})}),t.createElement(N.Screen,{name:"AccountSwitcherAddAccount",component:R(o,e),options:{headerTitle:"Add account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}}),t.createElement(N.Screen,{name:"AccountSwitcherEditAccount",component:R(q,e),options:{headerTitle:"Edit account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}})))}function be(e){Fe(e),ke(e)}const ee={navigation:{}};function Fe(e){e.after(we,"default",(n,o,r)=>({...r,AccountSwitcherMain:{key:"AccountSwitcherMain",title:"Account Switcher",render:R(Q,F.name),headerRight:()=>t.createElement(X,{navigation:ee.navigation,isFromUserSettings:!0})},AccountSwitcherAddAccount:{key:"AccountSwitcherAddAccount",title:"Add Account",render:R(J,F.name)},AccountSwitcherEditAccount:{key:"AccountSwitcherEditAccount",title:"Edit Account",render:R(q,F.name)}}))}function ke(e){const n=re("UserSettingsOverviewWrapper",{default:!1}),o=e.after(n,"default",(r,u,a)=>{e.after(a.type.prototype,"render",({props:{navigation:s}},c,d)=>{const{children:l}=d.props,g=l.findIndex(w=>T.Messages.LOGOUT===w.props.label);l[g].props.label="Account Switcher",l[g].props.onPress=()=>{s.navigate("AccountSwitcherMain",{navigation:s,isFromUserSettings:!0})},ee.navigation=s}),o()})}const te=ae("Welcome",{default:!1}),x=ce("account-switcher"),Ie={...F,onStart(){be(x);const e=t.createElement(_,{onPress:()=>C.push(Z,{name:this.name}),style:{marginBottom:0,backgroundColor:"#64d3ff"},text:"Account Switcher"});if(x.after(te,"default",(o,r,u)=>{const a=Y(u,c=>{var d,l,g;return((g=(l=(d=c==null?void 0:c.children)==null?void 0:d[0])==null?void 0:l.type)==null?void 0:g.name)==="Button"});if(!a)return;const s=a.children[a.children.length-1].props.style;a.children[a.children.length-1].props.style=[...Array.isArray(s)?s:[s],{marginBottom:12}],a.children.push(e)}),Boolean(p.getToken()))return;const n=x.before(h,"render",(o,[r],u)=>{const a=Y(r,s=>{var c;return((c=s==null?void 0:s.type)==null?void 0:c.name)==="Welcome"});!a||(a.type=te.default,n())})},onStop(){x.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(h,{onLayout:()=>{C.pop(),C.push(Z,{name:F.name})}})}};ne(Ie);
