function se(e){window.enmity.plugins.registerPlugin(e)}function me(e,o){return window.enmity.modules.getModule(e,o)}function O(...e){return window.enmity.modules.getByProps(...e)}function U(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function ue(e){return window.enmity.patcher.create(e)}var de="AccountSwitcher",ge="1.0.3",he="Switch between multiple accounts.",ye="#64D3FF",we=[{name:"ssense",id:"146080957965795328"}],I={name:de,version:ge,description:he,color:ye,authors:we};function Y(e,o,r){return window.enmity.utilities.findInReactTree(e,o,r)}const b=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars;const pe=window.enmity.modules.common.Native,t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const W=window.enmity.modules.common.Toasts,K=window.enmity.modules.common.Dialog,F=window.enmity.modules.common.Token;window.enmity.modules.common.REST,window.enmity.modules.common.Settings;const Se=window.enmity.modules.common.Users,T=window.enmity.modules.common.Navigation,R=window.enmity.modules.common.NavigationNative,X=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const D=window.enmity.modules.common.StyleSheet,z=window.enmity.modules.common.ColorMap;window.enmity.modules.common.Components;const f=window.enmity.modules.common.Locale,Ae=window.enmity.modules.common.Profiles;window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG;const Ee=window.enmity.modules.common.Scenes,{components:n}=window.enmity,fe=n.Alert,Ce=n.Button;n.FlatList;const H=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal,n.Pressable;const Te=n.RefreshControl,Re=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const S=n.Text;n.TextInput,n.TouchableHighlight;const x=n.TouchableOpacity;n.TouchableWithoutFeedback,n.Touchable;const g=n.View;n.VirtualizedList,n.Form;const q=n.FormArrow;n.FormCTA;const ve=n.FormCTAButton;n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon;const k=n.FormInput;n.FormLabel,n.FormRadio;const p=n.FormRow;n.FormSection,n.FormSelect,n.FormSubLabel,n.FormSwitch,n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;function C(e){return window.enmity.assets.getIDByName(e)}const j=O("loginToken"),{default:$}=me(e=>e==null?void 0:e.ButtonColors),J=e=>e.id?{id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar,...e.email&&{email:e.email},...e.phone&&{phone:e.phone}}:{};async function Q(e){const o=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return J(o)}const Ie=()=>{const e=()=>{j.logout()};K.show({isDismissable:!0,title:f.Messages.LOGOUT,body:f.Messages.USER_SETTINGS_CONFIRM_LOGOUT,confirmColor:"red",confirmText:f.Messages.LOGOUT,cancelText:f.Messages.CANCEL,onConfirm:e})},Z=({title:e="Are you sure?",body:o,confirmColor:r,confirmText:i="Yes",cancelText:s="No",onConfirm:a,onCancel:c})=>{if(!F.getToken())return fe.alert(e,o,[{text:i,onPress:a},{text:s,onPress:c}]);K.show({isDismissable:!0,title:e,body:o,confirmColor:r,confirmText:i,cancelText:s,onConfirm:a,onCancel:c})},A={AddWhite:C("add_white"),Checkmark:C("Check"),Key:C("ic_authed_apps_24px"),MyAccount:C("ic_my_account_24px"),Passport:C("ic_passport_24px"),Settings:C("settings"),TrashFilled:C("ic_trash_filled_16px"),Sort:C("ic_sort")},ee=O("openLazy","hideActionSheet"),G=O("hex2int"),be=U("CustomColorPickerActionSheet"),te=({onSelect:e,defaultColor:o="#000000",resetText:r=f.Messages.RESET})=>{const i=G.hex2int(o);ee.openLazy(()=>Promise.resolve(be),"CustomColorPicker",{color:i,onSelect:e,resetText:r,resetColor:i})};function M(e,o){return window.enmity.settings.connectComponent(e,o)}const{ThemeColorMap:ne}=z;function Fe({account:e}){if(!e)return null;const o=D.createThemedStyleSheet({linkless:{color:ne.HEADER_SECONDARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD,display:"flex",fontSize:16,alignItems:"center",alignSelf:"center",justifyContent:"center"},link:{color:ne.HEADER_PRIMARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD,display:"flex",alignItems:"center",fontSize:16,alignSelf:"center",justifyContent:"center"}});return t.createElement(g,null,(r=>typeof r=="string"?t.createElement(S,{style:o.linkless},r):typeof r=="object"&&r.username&&!r.id?t.createElement(S,{style:o.linkless},r.username):typeof r=="object"&&r.username&&r.id?t.createElement(x,{key:r.id,onPress:()=>Ae.showUserProfile({userId:r.id})},t.createElement(S,{style:o.link},r.username)):null)(e))}const{ThemeColorMap:_}=z,{RNCPushNotificationIOS:ke}=pe;function Me({account:e,position:o,settings:r,navigation:i}){var s,a;const c=D.createThemedStyleSheet({container:{backgroundColor:_.BACKGROUND_SECONDARY,borderRadius:5,borderLeftColor:(s=e.color)!=null?s:"#524FBF",borderLeftWidth:5,marginBottom:15},name:{color:_.HEADER_PRIMARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD,fontSize:16},content:{height:"auto",paddingBottom:10,paddingLeft:10,paddingRight:10},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},description:{color:_.HEADER_SECONDARY,fontFamily:b.Fonts.PRIMARY_SEMIBOLD},info:{marginLeft:-6,flexDirection:"row",alignItems:"center",flexWrap:"wrap",width:"100%"},delete:{marginRight:7.5},trashIcon:{width:22,height:22,tintColor:_.INTERACTIVE_NORMAL},settingsIcon:{width:22,height:22,tintColor:_.INTERACTIVE_NORMAL}});return t.createElement(x,{style:c.container,onPress:()=>{const l=()=>{T.popAll(),ke.abandonPermissions(),j.loginToken(e.token),W.open({content:`Switched to ${e.user.username}`,source:A.Checkmark})};Z({body:`Switch to ${e.label||e.user.username+"#"+e.user.discriminator}?`,onConfirm:l})}},t.createElement(g,null,t.createElement(p,{label:()=>t.createElement(g,{style:c.info},e.label&&t.createElement(S,{adjustsFontSizeToFit:!0,style:c.name},`${e.label} ( `),t.createElement(Fe,{account:e.user}),e.label&&t.createElement(S,{adjustsFontSizeToFit:!0,style:c.name}," )")),trailing:()=>t.createElement(g,{style:c.actions},t.createElement(x,{style:c.delete,onPress:()=>{i.navigate("AccountSwitcherEditAccount",{account:e,position:o})}},t.createElement(H,{style:c.settingsIcon,source:A.Settings})),t.createElement(x,{style:c.delete,onPress:()=>{const l=()=>{const m=r.get("accounts",[]);m.splice(o,1),r.set("accounts",m),W.open({content:"Account Deleted",source:A.Checkmark})};Z({body:e.label?`Delete ${e.label} (${e.user.username}#${e.user.discriminator})?`:`Delete ${e.user.username}#${e.user.discriminator}?`,confirmColor:"red",onConfirm:l})}},t.createElement(H,{style:c.trashIcon,source:A.TrashFilled})))})),t.createElement(g,{style:c.content},t.createElement(S,{style:c.description},(a=e.description)!=null?a:`ID: ${e.user.id}`)))}const{createThemedStyleSheet:Pe}=D;var xe=({settings:e,navigation:o})=>{const[r,i]=t.useState(!1),s=()=>{const m=e.get("accounts",[]);return Array.isArray(m)&&m.sort((d,y)=>{var h,E;return((h=d.label)==null?void 0:h.localeCompare(y.label))||((E=d.username)==null?void 0:E.localeCompare(y.username))})},[a,c]=t.useState(s()),l=Pe({container:{flex:1,padding:5}});return t.createElement(t.Fragment,null,t.createElement(g,{style:l.container},t.createElement(Re,{style:l.container,refreshControl:t.createElement(Te,{refreshing:r,onRefresh:()=>{i(!0),c(s()),i(!1)}})},Array.isArray(a)&&a.map((m,d)=>t.createElement(Me,{account:m,position:d,settings:e,navigation:o})),t.createElement(p,{label:"Add Account (Token)",leading:t.createElement(p.Icon,{source:A.Key}),onPress:()=>{o.navigate("AccountSwitcherAddAccount")}}),Boolean(F.getToken())&&t.createElement(p,{label:"Add Current Account",leading:t.createElement(p.Icon,{source:A.MyAccount}),onPress:()=>{o.navigate("AccountSwitcherAddAccount",{token:F.getToken(),user:J(Se.getCurrentUser())})}}),t.createElement(p,{label:"Add Account (User/Pass)",leading:t.createElement(p.Icon,{source:A.Passport}),onPress:()=>{Boolean(F.getToken())&&j.loginToken(""),T.popAll()}}),Boolean(F.getToken())&&t.createElement(ve,{color:"danger",label:f.Messages.LOGOUT,onPress:Ie}))))};const N=X.createStackNavigator(),{createThemedStyleSheet:L}=D,{ThemeColorMap:v,Colors:oe}=z;function re({navigation:e=R.useNavigation()}){const o=L({header:{tintColor:v.HEADER_PRIMARY,marginRight:15,width:18,height:18},wrapper:{marginRight:15,width:32,height:32}});return t.createElement(x,{styles:o.wrapper,onPress:()=>{e.navigate("AccountSwitcherAddAccount")}},t.createElement(H,{style:o.header,source:A.AddWhite}))}function ie({settings:e,navigation:o=R.useNavigation(),route:r=R.useRoute()}){const{account:i,position:s}=r.params,[a,c]=t.useState(i.token),[l,m]=t.useState(i.label||""),[d,y]=t.useState(i.description||""),[h,E]=t.useState(i.color||"#524FBF"),w=L({container:{flex:1,padding:16},colorBlock:{minWidth:24,height:24,borderRadius:3,marginHorizontal:0,marginVertical:0,marginRight:8,justifyContent:"center",alignItems:"center"},colorText:{fontFamily:b.Fonts.PRIMARY_SEMIBOLD,color:oe.PRIMARY_DARK_400},row:{flexDirection:"row",alignItems:"center"}});return t.createElement(g,{style:w.container},t.createElement(k,{value:a,onChange:u=>c(u),title:"Account Token"}),t.createElement(k,{value:l,onChange:u=>m(u),title:"Label"}),t.createElement(k,{value:d,onChange:u=>y(u),title:"Description"}),t.createElement(p,{label:()=>t.createElement(S,{adjustsFontSizeToFit:!0,style:w.colorText},"Color"),trailing:()=>t.createElement(g,{style:w.row},t.createElement(g,{style:[w.colorBlock,{backgroundColor:h}]}),t.createElement(S,{style:w.colorText},h),t.createElement(q,null)),onPress:()=>te({onSelect:u=>E(G.int2hex(u)),defaultColor:h})}),t.createElement(g,{style:w.row},t.createElement($,{onPress:async function(){const u=await Q(a),P=e.get("accounts",[]);P[s]={token:a,user:u,label:l||null,description:d||null,color:h||null},e.set("accounts",P),o.goBack()},text:"Save account"})))}function ce({settings:e,navigation:o=R.useNavigation(),route:r=R.useRoute()}){const{token:i,user:s}=(r==null?void 0:r.params)||{},[a,c]=t.useState(i||""),[l,m]=t.useState(""),[d,y]=t.useState(""),[h,E]=t.useState("#524FBF"),w=L({container:{flex:1,padding:16},colorBlock:{minWidth:24,height:24,borderRadius:3,marginHorizontal:0,marginVertical:0,marginRight:8,justifyContent:"center",alignItems:"center"},colorText:{fontFamily:b.Fonts.PRIMARY_SEMIBOLD,color:oe.PRIMARY_DARK_400},row:{flexDirection:"row",alignItems:"center"}});return t.createElement(g,{style:w.container},t.createElement(k,{disabled:Boolean(i),value:i||"",onChange:u=>c(u),title:"Account Token"}),t.createElement(k,{onChange:u=>m(u),title:"Label"}),t.createElement(k,{onChange:u=>y(u),title:"Description"}),t.createElement(p,{label:()=>t.createElement(S,{adjustsFontSizeToFit:!0,style:w.colorText},"Color"),trailing:()=>t.createElement(g,{style:w.row},t.createElement(g,{style:[w.colorBlock,{backgroundColor:h}]}),t.createElement(S,{style:w.colorText},h),t.createElement(q,null)),onPress:()=>te({onSelect:u=>E(G.int2hex(u)),defaultColor:h})}),t.createElement(g,{style:w.row},t.createElement($,{onPress:async function(){const u=s||await Q(a),P=e.get("accounts",[]);P.push({token:a,user:u,label:l||null,description:d||null,color:h||null}),e.set("accounts",P),o.goBack()},text:"Add account"})))}function ae({settings:e,navigation:o=R.useNavigation()}){return t.createElement(xe,{settings:e,navigation:o})}function V({name:e="pluginName",mainScreen:o=ae,addAccount:r=ce}={}){const i=L({container:{backgroundColor:v.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:v.BACKGROUND_MOBILE_PRIMARY,color:v.TEXT_NORMAL},header:{backgroundColor:v.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:v.HEADER_PRIMARY},close:{color:v.HEADER_PRIMARY}});return t.createElement(R.NavigationContainer,null,t.createElement(N.Navigator,{initialRouteName:e,style:i.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:i.cardStyle,headerStyle:i.header,headerTitleContainerStyle:i.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(N.Screen,{name:e,component:M(o,e),options:({navigation:s})=>({headerTitle:"Account Switcher",headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(Ce,{color:i.close.color,title:"Close",onPress:()=>T.pop()}),headerRight:()=>t.createElement(re,{navigation:s}),...X.TransitionPresets.ModalSlideFromBottomIOS})}),t.createElement(N.Screen,{name:"AccountSwitcherAddAccount",component:M(r,e),options:{headerTitle:"Add account",headerTitleStyle:{color:"white"},headerTintColor:i.close.color}}),t.createElement(N.Screen,{name:"AccountSwitcherEditAccount",component:M(ie,e),options:{headerTitle:"Edit account",headerTitleStyle:{color:"white"},headerTintColor:i.close.color}})))}function _e(e){Be(e),De(e)}function Be(e){e.after(Ee,"default",(o,r,i)=>({...i,AccountSwitcherMain:{key:"AccountSwitcherMain",title:"Account Switcher",render:M(ae,I.name),headerRight:re},AccountSwitcherAddAccount:{key:"AccountSwitcherAddAccount",title:"Add Account",render:M(ce,I.name)},AccountSwitcherEditAccount:{key:"AccountSwitcherEditAccount",title:"Edit Account",render:M(ie,I.name)}}))}function De(e){const o=U("UserSettingsOverviewWrapper",{default:!1}),r=e.after(o,"default",(i,s,a)=>{const c=Y(a,l=>{var m;return((m=l.type)==null?void 0:m.name)==="UserSettingsOverview"});e.after(c.type.prototype,"render",({props:{navigation:l}},m,d)=>{const{children:y}=d.props,h=y.findIndex(E=>f.Messages.LOGOUT===E.props.label);y[h].props.label="Account Switcher",y[h].props.onPress=()=>{l.navigate("AccountSwitcherMain")}}),r()})}function Ne(e){const o=e.before(ee,"openLazy",({hideActionSheet:r},[i,s])=>{s==="StatusPicker"&&i.then(a=>{e.after(a,"default",(c,l,m)=>{const d=m.props.children[1].props.children.props.children;d.push({...d[0],props:{children:t.createElement(p,{leading:t.createElement(p.Icon,{source:A.Sort}),label:f.Messages.SWITCH_ACCOUNTS_MENU_ITEM_TITLE,trailing:p.Arrow,onPress:()=>{r(),T.push(V,{name:I.name})}})}})}),o()})})}const le=U("Welcome",{default:!1}),B=ue("account-switcher"),Le={...I,onStart(){_e(B),Ne(B);const e=t.createElement($,{onPress:()=>T.push(V,{name:this.name}),style:{marginBottom:0,backgroundColor:"#64d3ff"},text:"Account Switcher"});if(B.after(le,"default",(r,i,s)=>{const a=Y(s,l=>{var m,d,y;return((y=(d=(m=l==null?void 0:l.children)==null?void 0:m[0])==null?void 0:d.type)==null?void 0:y.name)==="Button"});if(!a)return;const c=a.children[a.children.length-1].props.style;a.children[a.children.length-1].props.style=[...Array.isArray(c)?c:[c],{marginBottom:12}],a.children.push(e)}),Boolean(F.getToken()))return;const o=B.before(g,"render",(r,[i],s)=>{const a=Y(i,c=>{var l;return((l=c==null?void 0:c.type)==null?void 0:l.name)==="Welcome"});!a||(a.type=le.default,o())})},onStop(){B.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(g,{onLayout:()=>{T.pop(),T.push(V,{name:I.name})}})}};se(Le);
