function ne(e){window.enmity.plugins.registerPlugin(e)}function oe(e,o){return window.enmity.modules.getModule(e,o)}function ie(...e){return window.enmity.modules.getByProps(...e)}function re(...e){return window.enmity.modules.getByTypeName(...e)}function ce(...e){return window.enmity.modules.getByName(...e)}window.enmity.modules.common;function ae(e){return window.enmity.patcher.create(e)}var le="AccountSwitcher",se="1.0.1",me="Switch between multiple accounts.",ue="#64D3FF",de=[{name:"ssense",id:"146080957965795328"}],F={name:le,version:se,description:me,color:ue,authors:de};function j(e,o,i){return window.enmity.utilities.findInReactTree(e,o,i)}const D=window.enmity.modules.common.Constants;window.enmity.modules.common.Clipboard,window.enmity.modules.common.Assets,window.enmity.modules.common.Messages,window.enmity.modules.common.Clyde,window.enmity.modules.common.Avatars,window.enmity.modules.common.Native;const t=window.enmity.modules.common.React;window.enmity.modules.common.Dispatcher,window.enmity.modules.common.Storage;const H=window.enmity.modules.common.Toasts,$=window.enmity.modules.common.Dialog,T=window.enmity.modules.common.Token;window.enmity.modules.common.REST,window.enmity.modules.common.Settings;const ge=window.enmity.modules.common.Users,v=window.enmity.modules.common.Navigation,f=window.enmity.modules.common.NavigationNative,V=window.enmity.modules.common.NavigationStack;window.enmity.modules.common.Theme,window.enmity.modules.common.Linking;const N=window.enmity.modules.common.StyleSheet,L=window.enmity.modules.common.ColorMap;window.enmity.modules.common.Components;const R=window.enmity.modules.common.Locale,he=window.enmity.modules.common.Profiles;window.enmity.modules.common.Lodash,window.enmity.modules.common.Logger,window.enmity.modules.common.Flux,window.enmity.modules.common.SVG;const we=window.enmity.modules.common.Scenes,{components:n}=window.enmity,ye=n.Alert,pe=n.Button;n.FlatList;const U=n.Image;n.ImageBackground,n.KeyboardAvoidingView,n.Modal,n.Pressable;const fe=n.RefreshControl,Se=n.ScrollView;n.SectionList,n.StatusBar,n.StyleSheet,n.Switch;const b=n.Text;n.TextInput,n.TouchableHighlight;const B=n.TouchableOpacity;n.TouchableWithoutFeedback,n.Touchable;const h=n.View;n.VirtualizedList,n.Form,n.FormArrow,n.FormCTA;const Ae=n.FormCTAButton;n.FormCardSection,n.FormCheckbox,n.FormDivider,n.FormHint,n.FormIcon;const y=n.FormInput;n.FormLabel,n.FormRadio;const S=n.FormRow;n.FormSection,n.FormSelect,n.FormSubLabel,n.FormSwitch,n.FormTernaryCheckBox,n.FormText,n.FormTextColors,n.FormTextSizes;function A(e){return window.enmity.assets.getIDByName(e)}const Y=ie("loginToken"),{default:G}=oe(e=>e==null?void 0:e.ButtonColors),z=e=>e.id?{id:e.id,username:e.username,discriminator:e.discriminator,avatar:e.avatar,...e.email&&{email:e.email},...e.phone&&{phone:e.phone}}:{};async function W(e){const o=await(await fetch("https://discord.com/api/v9/users/@me",{headers:{authorization:e}})).json();return z(o)}const Ee=()=>{const e=()=>{Y.logout()};$.show({isDismissable:!0,title:R.Messages.LOGOUT,body:R.Messages.USER_SETTINGS_CONFIRM_LOGOUT,confirmColor:"red",confirmText:R.Messages.LOGOUT,cancelText:R.Messages.CANCEL,onConfirm:e})},K=({title:e="Are you sure?",body:o,confirmColor:i,confirmText:r="Yes",cancelText:s="No",onConfirm:a,onCancel:c})=>{if(!T.getToken())return ye.alert(e,o,[{text:r,onPress:a},{text:s,onPress:c}]);$.show({isDismissable:!0,title:e,body:o,confirmColor:i,confirmText:r,cancelText:s,onConfirm:a,onCancel:c})},p={AddWhite:A("add_white"),Checkmark:A("Check"),Key:A("ic_authed_apps_24px"),MyAccount:A("ic_my_account_24px"),Passport:A("ic_passport_24px"),Settings:A("settings"),TrashFilled:A("ic_trash_filled_16px")};function k(e,o){return window.enmity.settings.connectComponent(e,o)}const{ThemeColorMap:X}=L;function Ce({account:e}){if(!e)return null;const o=N.createThemedStyleSheet({linkless:{color:X.HEADER_SECONDARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,display:"flex",fontSize:16,alignItems:"center",alignSelf:"center",justifyContent:"center"},link:{color:X.HEADER_PRIMARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,display:"flex",alignItems:"center",fontSize:16,alignSelf:"center",justifyContent:"center"}});return t.createElement(h,null,(i=>typeof i=="string"?t.createElement(b,{style:o.linkless},i):typeof i=="object"&&i.username&&!i.id?t.createElement(b,{style:o.linkless},i.username):typeof i=="object"&&i.username&&i.id?t.createElement(B,{key:i.id,onPress:()=>he.showUserProfile({userId:i.id})},t.createElement(b,{style:o.link},i.username)):null)(e))}const{ThemeColorMap:M}=L;function Te({account:e,position:o,settings:i,navigation:r}){var s,a;const c=N.createThemedStyleSheet({container:{backgroundColor:M.BACKGROUND_SECONDARY,borderRadius:5,borderLeftColor:(s=e.color)!=null?s:"#524FBF",borderLeftWidth:5,marginBottom:15},name:{color:M.HEADER_PRIMARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD,fontSize:16},content:{height:"auto",paddingBottom:10,paddingLeft:10,paddingRight:10},actions:{justifyContent:"flex-end",flexDirection:"row",alignItems:"center"},description:{color:M.HEADER_SECONDARY,fontFamily:D.Fonts.PRIMARY_SEMIBOLD},info:{marginLeft:-6,flexDirection:"row",alignItems:"center",flexWrap:"wrap",width:"100%"},delete:{marginRight:7.5},trashIcon:{width:22,height:22,tintColor:M.INTERACTIVE_NORMAL},settingsIcon:{width:22,height:22,tintColor:M.INTERACTIVE_NORMAL}});return t.createElement(B,{style:c.container,onPress:()=>{const m=()=>{v.popAll(),Y.loginToken(e.token),H.open({content:"Account Switched",source:p.Checkmark})};K({body:`Switch to ${e.label||e.user.username+"#"+e.user.discriminator}?`,onConfirm:m})}},t.createElement(h,null,t.createElement(S,{label:()=>t.createElement(h,{style:c.info},e.label&&t.createElement(b,{adjustsFontSizeToFit:!0,style:c.name},`${e.label} ( `),t.createElement(Ce,{account:e.user}),e.label&&t.createElement(b,{adjustsFontSizeToFit:!0,style:c.name}," )")),trailing:()=>t.createElement(h,{style:c.actions},t.createElement(B,{style:c.delete,onPress:()=>{r.navigate("AccountSwitcherEditAccount",{account:e,position:o})}},t.createElement(U,{style:c.settingsIcon,source:p.Settings})),t.createElement(B,{style:c.delete,onPress:()=>{const m=()=>{const u=i.get("accounts",[]);u.splice(o,1),i.set("accounts",u),H.open({content:"Account Deleted",source:p.Checkmark})};K({body:e.label?`Delete ${e.label} (${e.user.username}#${e.user.discriminator})?`:`Delete ${e.user.username}#${e.user.discriminator}?`,confirmColor:"red",onConfirm:m})}},t.createElement(U,{style:c.trashIcon,source:p.TrashFilled})))})),t.createElement(h,{style:c.content},t.createElement(b,{style:c.description},(a=e.description)!=null?a:`ID: ${e.user.id}`)))}const{createThemedStyleSheet:ve}=N;var Re=({settings:e,navigation:o})=>{const[i,r]=t.useState(!1),s=()=>{const u=e.get("accounts",[]);return Array.isArray(u)&&u.sort((d,g)=>{var w,C;return((w=d.label)==null?void 0:w.localeCompare(g.label))||((C=d.username)==null?void 0:C.localeCompare(g.username))})},[a,c]=t.useState(s()),m=ve({container:{flex:1,padding:5}});return t.createElement(t.Fragment,null,t.createElement(h,{style:m.container},t.createElement(Se,{style:m.container,refreshControl:t.createElement(fe,{refreshing:i,onRefresh:()=>{r(!0),c(s()),r(!1)}})},Array.isArray(a)&&a.map((u,d)=>t.createElement(Te,{account:u,position:d,settings:e,navigation:o})),t.createElement(S,{label:"Add Account (Token)",leading:t.createElement(S.Icon,{source:p.Key}),onPress:()=>{o.navigate("AccountSwitcherAddAccount")}}),Boolean(T.getToken())&&t.createElement(S,{label:"Add Current Account",leading:t.createElement(S.Icon,{source:p.MyAccount}),onPress:()=>{o.navigate("AccountSwitcherAddAccount",{token:T.getToken(),user:z(ge.getCurrentUser())})}}),t.createElement(S,{label:"Add Account (User/Pass)",leading:t.createElement(S.Icon,{source:p.Passport}),onPress:()=>{Boolean(T.getToken())&&Y.loginToken(""),v.popAll()}}),Boolean(T.getToken())&&t.createElement(Ae,{color:"danger",label:R.Messages.LOGOUT,onPress:Ee}))))};const P=V.createStackNavigator(),{createThemedStyleSheet:x}=N,{ThemeColorMap:E}=L;function q({navigation:e=f.useNavigation()}){const o=x({header:{tintColor:E.HEADER_PRIMARY,marginRight:15,width:18,height:18},wrapper:{marginRight:15,width:32,height:32}});return t.createElement(B,{styles:o.wrapper,onPress:()=>{e.navigate("AccountSwitcherAddAccount")}},t.createElement(U,{style:o.header,source:p.AddWhite}))}function J({settings:e,navigation:o=f.useNavigation(),route:i=f.useRoute()}){const{account:r,position:s}=i.params,[a,c]=t.useState(r.token),[m,u]=t.useState(r.label||""),[d,g]=t.useState(r.description||""),[w,C]=t.useState(r.color||""),O=x({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:O.container},t.createElement(y,{value:a,onChange:l=>c(l),title:"Account Token"}),t.createElement(y,{value:m,onChange:l=>u(l),title:"Label"}),t.createElement(y,{value:d,onChange:l=>g(l),title:"Description"}),t.createElement(y,{value:w,onChange:l=>C(l),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(G,{onPress:async function(){const l=await W(a),I=e.get("accounts",[]);I[s]={token:a,user:l,label:m||null,description:d||null,color:w||null},e.set("accounts",I),o.goBack()},style:{backgroundColor:"#64d3ff"},text:"Save account"})))}function Q({settings:e,navigation:o=f.useNavigation(),route:i=f.useRoute()}){const{token:r,user:s}=(i==null?void 0:i.params)||{},[a,c]=t.useState(r||""),[m,u]=t.useState(""),[d,g]=t.useState(""),[w,C]=t.useState(""),O=x({container:{flex:1,padding:16,paddingTop:36,paddingBottom:36}});return t.createElement(h,{style:O.container},t.createElement(y,{disabled:Boolean(r),value:r||"",onChange:l=>c(l),title:"Account Token"}),t.createElement(y,{onChange:l=>u(l),title:"Label"}),t.createElement(y,{onChange:l=>g(l),title:"Description"}),t.createElement(y,{value:w,onChange:l=>C(l),title:"Color"}),t.createElement(h,{style:{flexDirection:"row",justifyContent:"space-between"}},t.createElement(G,{onPress:async function(){const l=s||await W(a),I=e.get("accounts",[]);I.push({token:a,user:l,label:m||null,description:d||null,color:w||null}),e.set("accounts",I),o.goBack()},style:{backgroundColor:"#64d3ff"},text:"Add account"})))}function Z({settings:e,navigation:o=f.useNavigation()}){return t.createElement(Re,{settings:e,navigation:o})}function ee({name:e="pluginName",mainScreen:o=Z,addAccount:i=Q}={}){const r=x({container:{backgroundColor:E.BACKGROUND_MOBILE_SECONDARY,flex:1},cardStyle:{backgroundColor:E.BACKGROUND_MOBILE_PRIMARY,color:E.TEXT_NORMAL},header:{backgroundColor:E.BACKGROUND_MOBILE_SECONDARY,shadowColor:"transparent",elevation:0},headerTitleContainer:{color:E.HEADER_PRIMARY},close:{color:E.HEADER_PRIMARY}});return t.createElement(f.NavigationContainer,null,t.createElement(P.Navigator,{initialRouteName:e,style:r.container,screenOptions:{cardOverlayEnabled:!1,cardShadowEnabled:!1,cardStyle:r.cardStyle,headerStyle:r.header,headerTitleContainerStyle:r.headerTitleContainer,headerTitleAlign:"center",safeAreaInsets:{top:0}}},t.createElement(P.Screen,{name:e,component:k(o,e),options:({navigation:s})=>({headerTitle:"Account Switcher",headerTitleStyle:{color:"white"},headerLeft:()=>t.createElement(pe,{color:r.close.color,title:"Close",onPress:()=>v.pop()}),headerRight:()=>t.createElement(q,{navigation:s}),...V.TransitionPresets.ModalSlideFromBottomIOS})}),t.createElement(P.Screen,{name:"AccountSwitcherAddAccount",component:k(i,e),options:{headerTitle:"Add account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}}),t.createElement(P.Screen,{name:"AccountSwitcherEditAccount",component:k(J,e),options:{headerTitle:"Edit account",headerTitleStyle:{color:"white"},headerTintColor:r.close.color}})))}function be(e){ke(e),Ie(e)}function ke(e){e.after(we,"default",(o,i,r)=>({...r,AccountSwitcherMain:{key:"AccountSwitcherMain",title:"Account Switcher",render:k(Z,F.name),headerRight:q},AccountSwitcherAddAccount:{key:"AccountSwitcherAddAccount",title:"Add Account",render:k(Q,F.name)},AccountSwitcherEditAccount:{key:"AccountSwitcherEditAccount",title:"Edit Account",render:k(J,F.name)}}))}function Ie(e){const o=re("UserSettingsOverviewWrapper",{default:!1}),i=e.after(o,"default",(r,s,a)=>{e.after(a.type.prototype,"render",({props:{navigation:c}},m,u)=>{const{children:d}=u.props,g=d.findIndex(w=>R.Messages.LOGOUT===w.props.label);d[g].props.label="Account Switcher",d[g].props.onPress=()=>{c.navigate("AccountSwitcherMain")}}),i()})}const te=ce("Welcome",{default:!1}),_=ae("account-switcher"),Fe={...F,onStart(){be(_);const e=t.createElement(G,{onPress:()=>v.push(ee,{name:this.name}),style:{marginBottom:0,backgroundColor:"#64d3ff"},text:"Account Switcher"});if(_.after(te,"default",(i,r,s)=>{const a=j(s,m=>{var u,d,g;return((g=(d=(u=m==null?void 0:m.children)==null?void 0:u[0])==null?void 0:d.type)==null?void 0:g.name)==="Button"});if(!a)return;const c=a.children[a.children.length-1].props.style;a.children[a.children.length-1].props.style=[...Array.isArray(c)?c:[c],{marginBottom:12}],a.children.push(e)}),Boolean(T.getToken()))return;const o=_.before(h,"render",(i,[r],s)=>{const a=j(r,c=>{var m;return((m=c==null?void 0:c.type)==null?void 0:m.name)==="Welcome"});!a||(a.type=te.default,o())})},onStop(){_.unpatchAll()},getSettingsPanel({settings:e}){return t.createElement(h,{onLayout:()=>{v.pop(),v.push(ee,{name:F.name})}})}};ne(Fe);
